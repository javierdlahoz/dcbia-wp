angular.module("angular-wp").controller("MembershipController",function(e,s,t){e.users={},e.c=-1,e.usernameTaken=!1,e.isSuccess=!1,e.billing={},e.membershipCost=null,e.disabledToSend=!1,e.loading=!1,e.add=function(){e.c++;var s=e.c;e.users[s]={id:s,first_name:"",last_name:"",email:"",password:"",committee:""}},e.remove=function(s){delete e.users[s]},e.initialize=function(){e.users={}},e.setCity=function(){"object"==typeof e.member.city&&(e.member.state=e.member.city.address_components[1].short_name,e.member.city=e.member.city.address_components[0].long_name)},e.register=function(){var t="/api/member/register";e.member.additional_users=e.users,s({url:t,method:"POST",data:jQuery.param(e.member),headers:getContentTypes().form}).success(function(){e.isSuccess=!0,window.location="/checkout"})},e.getMembershipLevels=function(){var t="/api/member/levels";s({url:t,method:"GET"}).success(function(s){e.membershipLevels=s})},e.setMembershipCost=function(){e.membershipCost=e.membershipLevels[e.member.membership_level-1].initial_payment},e.getAdditionalUsers=function(){var t="/api/member/affiliates";s({url:t,method:"GET"}).success(function(s){e.users=s.affiliates,e.c=s.affiliates.length-1})},e.setAdditionalUsers=function(){var t="/api/member/affiliates";e.member={},e.member.additional_users=e.users,s({url:t,method:"POST",data:jQuery.param(e.member),headers:getContentTypes().form}).success(function(){e.isSuccess=!0,window.location="/checkout"})},setDisabledToSend=function(s){e.disabledToSend=s},e.isUsernameTaken=function(){if(e.member.email.length>4){var t="/api/member/check";s({url:t,method:"POST",data:jQuery.param({email:e.member.email}),headers:getContentTypes().form}).success(function(s){e.usernameTaken=s.is_taken,setDisabledToSend(s.is_taken)})}},e.checkEmailForAffiliates=function(t){var a=e.users[t];if(a.email.length>4){var i="/api/member/check";s({url:i,method:"POST",data:jQuery.param({email:a.email}),headers:getContentTypes().form}).success(function(s){e.users[t].isTaken=s.is_taken,e.users[t].email==e.member.email&&(e.users[t].isTaken=!0),setDisabledToSend(s.is_taken)})}},e.charge=function(){e.loading=!0,e.billing.expiration_date=e.billing.expiration_month+e.billing.expiration_year,e.billing.country="US";var a="/api/member/pay";s({url:a,method:"POST",data:jQuery.param(e.billing),headers:getContentTypes().form}).success(function(s){e.billing.status=s.status,e.loading=!1,1==s.status&&t(function(){window.location="/"},5e3)})},e.getCurrentUser=function(){var t="/api/member/current";s({url:t,method:"GET"}).success(function(s){s.first_name!==!1&&(e.member=s,e.users=s.affiliates)})},angular.element("#address").attr("g-places-autocomplete",""),angular.element("#address").attr("ng-model","address"),angular.element("#city").attr("ng-model","city"),angular.element("#state").attr("ng-model","state")});